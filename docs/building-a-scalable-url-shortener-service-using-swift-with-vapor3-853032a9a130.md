# ä½¿ç”¨ Swift å’Œ Vapor3 æ„å»ºå¯æ‰©å±•çš„ URL Shortener æœåŠ¡

> åŸæ–‡ï¼š<https://medium.com/hackernoon/building-a-scalable-url-shortener-service-using-swift-with-vapor3-853032a9a130>

## ä½¿ç”¨ Swift å’Œ Vapor3 è¶…è¶Šâ€œä½ å¥½ï¼Œä¸–ç•Œâ€

![](img/ace38ae659487d483953be069e3f6c3e.png)

Photo by [Con Karampelas](https://unsplash.com/photos/gHrEvF7Ugb4?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/search/photos/screen?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

åœ¨æˆ‘å®Œæˆäº†å‡ ä¸ªåŸºæœ¬çš„ Vapor æ•™ç¨‹ï¼Œå¹¶ä½¿ç”¨ Vapor åˆ›å»ºäº†ä¸€ä¸ªæ¨¡æ‹ŸæœåŠ¡å™¨[ä¹‹åï¼Œæˆ‘åŠªåŠ›æ€è€ƒä¸‹ä¸€æ­¥è¯¥åšä»€ä¹ˆã€‚æˆ‘æœ€ç»ˆåœ¨ Medium ä¸Šçœ‹åˆ°äº†è¿™ä¸ªå¸–å­ï¼Œè¿™çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªå°è¯•ä½¿ç”¨](https://hackernoon.com/building-an-excellent-mock-server-in-swift-with-vapor-7e25aaa985e6) [Vapor](https://hackernoon.com/tagged/vapor) æ„å»ºçš„ä¼˜ç§€é¡¹ç›®ã€‚

[](/@vaibhav0109/how-to-build-a-tiny-url-service-that-scales-to-billions-f6fb5ea22e8c) [## å¦‚ä½•æ„å»ºä¸€ä¸ªè§„æ¨¡è¾¾åˆ°æ•°åäº¿çš„å¾®å° URL æœåŠ¡ï¼Ÿ

### æ„å»ºä¸€ä¸ªè§„æ¨¡è¾¾åˆ°æ•°åäº¿çš„ url shortner æœåŠ¡æ˜¯ä¸€ä¸ªè½¯ä»¶æ¶æ„æŒ‘æˆ˜ã€‚è¿™ä¸ªåšå®¢æ¶µç›–äº†åŸºæœ¬çš„â€¦

medium.com](/@vaibhav0109/how-to-build-a-tiny-url-service-that-scales-to-billions-f6fb5ea22e8c) 

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†åŸºäºä¸Šé¢æ–‡ç« ä¸­çš„ä¸€äº›è®¾è®¡ï¼Œé€šè¿‡ç»“åˆ [Vapor](https://github.com/vapor/vapor) ã€ [Redis](https://github.com/vapor/redis) ã€Nginx å’Œ [Postgres](https://github.com/vapor/fluent-postgresql) ï¼Œå¹¶åˆ©ç”¨ Docker æ¥ç®€åŒ–å¼€å‘å’Œæµ‹è¯•ï¼Œæ¥å®é™…æ„å»ºä¸€ä¸ª [URL](https://hackernoon.com/tagged/url) ç¼©çŸ­æœåŠ¡ã€‚

# ç›®æ ‡

è¯¥é¡¹ç›®çš„ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªå¯æ‰©å±•çš„ã€å¿«é€Ÿçš„ URL ç¼©çŸ­å™¨ï¼Œå®ƒå°†æ”¯æŒä½¿ç”¨ Vapor çš„è‡ªåŠ¨å’Œè‡ªå®šä¹‰ URL ç¼©çŸ­åŠŸèƒ½ã€‚åˆ›å»ºæŠ—æšä¸¾é”®çš„ç›®æ ‡ä¸åœ¨æœ¬é¡¹ç›®çš„è®¨è®ºèŒƒå›´ä¹‹å†…â€”â€”å‡è®¾é“¾æ¥åˆ›å»ºè€…æœ‰è´£ä»»ç¡®ä¿å…±äº«çš„ url ä¸ä¼šè¢«æœªæˆæƒçš„ç”¨æˆ·è®¿é—®ã€‚

# è®¾è®¡

æˆ‘å°†æŒ‰ç»„ä»¶åˆ†è§£è®¾è®¡ï¼Œç„¶åçœ‹çœ‹æ¯ä¸€éƒ¨åˆ†å¦‚ä½•é€‚åº”åˆ›å»ºæ–° url å’Œè®¿é—®ç°æœ‰ url çš„é€»è¾‘æµç¨‹ã€‚

## **è’¸æ±½ç½‘ç»œåº”ç”¨**

ä»è·¯ç”±é€»è¾‘åˆ°ç¼©çŸ­ç®—æ³•æœ¬èº«ï¼Œå¤§å¤šæ•°å®é™…çš„ä¸šåŠ¡é€»è¾‘å°†å‘ç”Ÿåœ¨ Vapor åº”ç”¨ç¨‹åºå†…éƒ¨ã€‚æˆ‘è¯•å›¾ä»¥è¿™æ ·ä¸€ç§æ–¹å¼æ¥è®¡åˆ’ï¼Œå¦‚æœå¿…è¦çš„è¯ï¼ŒVapor åº”ç”¨ç¨‹åºçš„å®ä¾‹æ•°é‡å¯ä»¥æŒ‰æ¯”ä¾‹å¢åŠ ä»¥æ»¡è¶³éœ€æ±‚ã€‚

## **Postgres æ•°æ®åº“**

Postgres å°†ä½œä¸ºåº”ç”¨ç¨‹åºçš„æŒä¹…å­˜å‚¨ã€‚Postgres ä¼¼ä¹æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒæ˜“äºä½¿ç”¨ï¼Œä½¿ç”¨ Fluent ä¸ vapor é›†æˆï¼Œå¹¶ä¸”å®ƒæ˜¯äº‘ä¸å¯çŸ¥çš„ã€‚

## **Redis**

é›·è¿ªæ–¯å°†æ‰¿æ‹…åŒé‡èŒè´£ã€‚é¦–å…ˆï¼Œå®ƒå°†å……å½“åŸå­è®¡æ•°å™¨ï¼Œä»¥ä¾¿å…è®¸åº”ç”¨ç¨‹åºçš„å¤šä¸ªå®ä¾‹å¹¶è¡Œè¿è¡Œã€‚å…¶æ¬¡ï¼Œå®ƒå°†å……å½“å¿«é€Ÿç¼“å­˜ï¼Œä»¥å“åº”é¢‘ç¹çš„é“¾æ¥è¯·æ±‚ã€‚

## **Nginx**

Nginx å°†å……å½“ä»»æ„æ•°é‡çš„ Vapor å®ä¾‹çš„è¾¹ç•Œåå‘ä»£ç†å’Œå¾ªç¯è¯·æ±‚ã€‚

## **Docker (docker-compose)**

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä½¿ç”¨ docker-compose å°†æ‰€æœ‰ä¸œè¥¿æ†ç»‘åœ¨ä¸€èµ·ï¼Œç®€åŒ–æœ¬åœ°å¼€å‘å’Œæµ‹è¯•ã€‚

![](img/5ae929034007b6e65c678a867af26ee8.png)

Network diagram

# ä»£ç 

## å…¥é—¨æŒ‡å—

æœ¬æ•™ç¨‹å‡è®¾ä½ å·²ç»å®‰è£…äº† [docker-compose](https://docs.docker.com/compose/install/) å’Œ [Vapor](https://docs.vapor.codes/3.0/install/macos/) ã€‚

é¦–å…ˆè¦åšçš„æ˜¯åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•æ¥å­˜å‚¨æˆ‘ä»¬æ‰€æœ‰çš„é¡¹ç›®æ–‡ä»¶ã€‚

ç„¶ååˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Vapor é¡¹ç›®ã€‚è¯¥å‘½ä»¤å°†ä¸ºæ‚¨è®¾ç½®ä¸€ä¸ªæ–°çš„ Vapor æ¨¡æ¿ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç¤ºä¾‹ ToDo åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚

å› ä¸ºæˆ‘å–œæ¬¢åˆ©ç”¨ XCode çš„ä»£ç è¡¥å…¨åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘è¿˜ä¼šæ·»åŠ ä¸€ä¸ª xcodeproj æ–‡ä»¶ï¼Œå¹¶åœ¨ XCode ä¸­æ‰“å¼€æˆ‘ä»¬çš„é¡¹ç›®ã€‚

## è„šæ‰‹æ¶

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨ dockerã€‚ç”±äº XCode å®é™…ä¸Šåªå…³å¿ƒåŒ…æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‘½ä»¤è¡Œåˆ›å»ºä¸€ä¸ª *Dockerfile* å’Œ *docker-compose.yml* æ–‡ä»¶ã€‚å› ä¸º docker åŸºç¡€çŸ¥è¯†è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒå›´ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šè®²å¤ªå¤šç»†èŠ‚ï¼Œä½†æ˜¯æˆ‘ä»¬å°†ç”¨äºå¼€å‘çš„æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯éå¸¸åŸºç¡€çš„ã€‚åœ¨ä»¥åçš„æ–‡ç« ä¸­ï¼Œæˆ‘å¯èƒ½ä¼šè€ƒè™‘ä¸ºç”Ÿäº§éƒ¨ç½²é…ç½®æ‚¨çš„åº”ç”¨ç¨‹åºã€‚

é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ *Dockerfile* å’Œ *docker-compose.yml* æ–‡ä»¶ã€‚

å°†ä»¥ä¸‹å†…å®¹ç²˜è´´åˆ°*æ–‡æ¡£*ä¸­ã€‚è¿™æ®µä»£ç å°†åœ¨ docker å®¹å™¨ä¸­æ„å»ºå’Œå¯åŠ¨æˆ‘ä»¬çš„ Vapor åº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨ç«¯å£ 8080 ä¸Šå…¬å¼€ APIã€‚

æ¥ä¸‹æ¥å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° *docker-compose.yml* æ–‡ä»¶ä¸­ã€‚è¿™é‡Œè¿˜æœ‰æ›´å¤šçš„ä¸œè¥¿ï¼Œä½†åœ¨è¾ƒé«˜çš„å±‚é¢ä¸Šï¼Œå®ƒå®šä¹‰äº†æˆ‘ä»¬çš„æ¯ä¸ªå›¾åƒ:Vapor åº”ç”¨ç¨‹åºçš„ **api** ï¼ŒPostgres æ•°æ®åº“çš„ **db** ï¼Œredis çš„ **redis** ï¼Œnginx çš„ **nginx** ã€‚å®ƒè¿˜å°†ä¸º Postgres é…ç½®ä¸€äº›åŸºæœ¬çš„èº«ä»½éªŒè¯ï¼Œå¹¶ä¸º db æ“ä½œå’ŒæœåŠ¡ API åˆ›å»ºå•ç‹¬çš„ç½‘ç»œã€‚

æ‚¨è¿˜éœ€è¦ä¸º nginx å®šä¹‰æ‚¨çš„é…ç½®ï¼Œä»¥ä¾¿è®©è½¬å‘æŒ‰é¢„æœŸå·¥ä½œã€‚æˆ‘çš„ *conf.d/api.conf* æ–‡ä»¶çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ã€‚

## è’¸æ±½ç½‘ç»œåº”ç”¨

é¦–å…ˆè¦çœ‹çš„ Vapor ä»£ç æ˜¯æˆ‘ä»¬çš„ *Package.swift* æ–‡ä»¶ã€‚æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼Œæˆ‘ä»¬å¸Œæœ›ç¡®ä¿æˆ‘ä»¬çš„é¡¹ç›®æ‹¥æœ‰ä¸ Redis å’Œ Postgres äº¤äº’æ‰€éœ€çš„æ‰€æœ‰å¿…è¦ä¾èµ–é¡¹ã€‚ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢ç°æœ‰çš„ *Package.swift* æ–‡ä»¶ã€‚

**é…ç½®**

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ *configure.swift* æ–‡ä»¶ï¼Œçœ‹çœ‹æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ Vapor åº”ç”¨ç¨‹åºä¸­ docker æ–‡ä»¶ä¸­æè¿°çš„ä¸€äº›ç¯å¢ƒå˜é‡ã€‚è¿™ä¸ªæ–‡ä»¶ç›¸å½“ç®€å•ï¼Œæ³¨é‡Šåº”è¯¥å¯ä»¥æ¶ˆé™¤ä»»ä½•æ­§ä¹‰ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šåœ¨è¿™é‡Œè¯¦ç»†è®¨è®ºã€‚

è‡³äºå…¶ä½™çš„æ ·æ¿ä»£ç ï¼Œåœ¨ä½ çš„é¡¹ç›®ä¸­åº”è¯¥æœ‰ä¸€ä¸ª app.swift å’Œä¸€ä¸ª *boot.swift* æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨çš„ç¼ºçœå€¼å¯¹æˆ‘ä»¬çš„ç›®çš„æ¥è¯´å¾ˆå¥½ã€‚

**è½¦å‹**

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ é™¤æ¨¡æ¿ä¸­åŒ…å«çš„ *Todo.swift* æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ Link.swift æ–‡ä»¶æ¥æè¿°æˆ‘ä»¬çš„ *Link* æ¨¡å‹ã€‚é“¾æ¥æ¨¡å‹ä¸åŒ…å«ä»»ä½•æ„å¤–çš„ç‰¹æ€§ã€‚å®ƒæœ‰ä¸€ä¸ª [**id** ï¼Œè¿™æ˜¯ Fluent](https://docs.vapor.codes/3.0/fluent/models/#id) ä¸­çš„ä¸€ä¸ªç‰¹æ®Šå­—æ®µï¼›è¿˜æœ‰ä¸€ä¸ª friendlyUrlï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Urlï¼›ä¸€ä¸ª shortUrlï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå°†é‡å®šå‘åˆ°åŸå§‹ Url çš„ç¼©çŸ­ Urlï¼›ä¸€ä¸ª createdAt å…ƒæ•°æ®å±æ€§ï¼Œ [vapor å¯ä»¥è‡ªåŠ¨å¡«å……å®ƒ](https://docs.vapor.codes/2.0/fluent/model/#timestamps)ï¼Œæœ€åè¿˜æœ‰ä¸€ä¸ª expiresAt å±æ€§ï¼Œå¯ä»¥ç”¨æ¥æ¸…ç†æ—§é“¾æ¥ã€‚

ç¨åæˆ‘å°†ä»‹ç»æˆ‘ä»¬è®¡åˆ’å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ•°æ®åº“çš„çŸ­ url å’Œ id è¿›è¡ŒæŸ¥è¯¢ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬ä¹Ÿå…è®¸ç”¨æˆ·ä½¿ç”¨è‡ªå®šä¹‰çš„â€œå‹å¥½â€urlï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿåº”è¯¥ä¸ºæ­¤æ·»åŠ ä¸€ä¸ªå”¯ä¸€çš„ç´¢å¼•ã€‚åœ¨é¡¹ç›®çš„ *App* ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º *Migrations* çš„æ–°ç›®å½•ã€‚åœ¨è¿™ä¸ªç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º *migrations.swift* çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ã€‚åœ¨ä¸Šé¢çš„ configure.swift ä¸­ï¼Œä»ç¬¬ 56 è¡Œå¼€å§‹ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å®é™…è¿è¡Œè¿™ä¸ªè¿ç§»çš„ä»£ç ã€‚

**è·¯ç”±**

æ¥ä¸‹æ¥æˆ‘ä»¬å°†æŸ¥çœ‹*è·¯çº¿ã€‚swift* è¿™æ˜¯ Vapor å¸Œæœ›æ‚¨çš„è·¯çº¿è¢«å®šä¹‰çš„åœ°æ–¹ã€‚å› ä¸ºè¿™ä¸ªæœåŠ¡å®é™…ä¸Šåªæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼›1.åˆ›å»ºé‡å®šå‘(é“¾æ¥)å’Œ 2ã€‚é‡å®šå‘è¯·æ±‚ï¼Œæˆ‘ä»¬çš„ *routes.swift* æ–‡ä»¶å°†éå¸¸ç®€å•ã€‚ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢è‡ªåŠ¨ç”Ÿæˆçš„ *routes.swift* æ–‡ä»¶ã€‚

**æ§åˆ¶å™¨**

æœ€åï¼Œæˆ‘ä»¬åˆ°è¾¾æ§åˆ¶å™¨ï¼Œä¸ºæˆ‘ä»¬çš„ API æœåŠ¡çš„å®é™…ä¸šåŠ¡é€»è¾‘ã€‚è¿™é‡Œæœ‰å‡ ä¸ªå·¥ä½œæµï¼Œæ‰€ä»¥æˆ‘å°†é€ä¸€ä»‹ç»ã€‚

1.  ä¿å­˜æ–°é“¾æ¥

æ­£å¦‚ä½ åœ¨ä¸Šé¢çš„ *routing.swift* ä¸­çœ‹åˆ°çš„ï¼Œåˆ›å»ºä¸€ä¸ªæ–°é“¾æ¥æ˜¯é€šè¿‡å‘`/links`å‘å‡º POST è¯·æ±‚æ¥å®Œæˆçš„ã€‚å½“å‘å‡ºè¯·æ±‚æ—¶ï¼Œå®ƒè¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å‘ redis è¯·æ±‚ä¸€ä¸ªæ¥è‡ªåŸå­è®¡æ•°å™¨çš„æ–° idã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªæ•°å­— id å’Œ POST è¯·æ±‚ä¸­æä¾›çš„å…¶ä½™æœ‰æ•ˆè´Ÿè½½æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Link å®ä¾‹ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ° Postgresã€‚å‡è®¾ä¿å­˜æˆåŠŸï¼Œæˆ‘ä»¬å°†æŠŠè¿™ä¸ªé“¾æ¥æ·»åŠ åˆ° redis ç¼“å­˜ä¸­å¹¶è¿”å›å¯¹è±¡ã€‚

2.é‡æ–°å¯„é€

è¯¥æœåŠ¡çš„ç¬¬äºŒéƒ¨åˆ†æ˜¯å°†æ‰€æœ‰ GET è¯·æ±‚é‡å®šå‘åˆ°é€‚å½“çš„ url(å¦‚æœå­˜åœ¨çš„è¯)ã€‚æˆ‘ç¨åå°†ä»‹ç»è¯¥æœåŠ¡ä½¿ç”¨çš„ç¼©çŸ­ç®—æ³•ï¼Œä½†æ˜¯é€šå¸¸è¯¥æœåŠ¡ä¼šé¦–å…ˆæ£€æŸ¥ redisï¼Œçœ‹å®ƒæ˜¯å¦ç¼“å­˜äº†é‡å®šå‘ã€‚å‡è®¾å®ƒåœ¨ redis ä¸­æ²¡æœ‰æ‰¾åˆ°åŒ¹é…ï¼Œå®ƒå°†æŠŠè¯·æ±‚ä¼ é€’ç»™ look up()ï¼Œlookup()å°†å°è¯•æ ¹æ®æˆ‘ä»¬çš„ base62 ç¼–ç çš„ id æˆ–è€…æ ¹æ®ç”¨æˆ·å®šä¹‰çš„å‹å¥½ url æ¥æŸ¥æ‰¾ urlã€‚ä¸ç®¡ä½¿ç”¨ä»€ä¹ˆæŸ¥æ‰¾æ–¹æ³•ï¼Œå¦‚æœæ‰¾åˆ°ç»“æœï¼Œæˆ‘ä»¬å°†æ„é€ ä¸€ä¸ªå¤§å¤šæ•°æµè§ˆå™¨éƒ½åº”è¯¥éµå¾ªçš„ 307 é‡å®šå‘å“åº”ã€‚å¦‚æœåœ¨ redis æˆ– Postgres ä¸­æ²¡æœ‰æ‰¾åˆ°ç»“æœï¼Œåˆ™è¿”å› 404 é”™è¯¯ã€‚

## ç¼©çŸ­ç½‘å€

å› ä¸ºæˆ‘ä»¬å°†ä¸»è¦ä¾èµ–æ•´æ•° id è¿›è¡Œé“¾æ¥æŸ¥æ‰¾ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŸç§æ–¹æ³•å°†æ•´æ•°ç¼©çŸ­ä¸ºæ›´ç´§å‡‘çš„æ ¼å¼ã€‚æ•´æ•°åœ¨è¾¾åˆ° 100ï¼Œ000 æˆ–æ•°ç™¾ä¸‡ä¹‹å‰éƒ½å·¥ä½œå¾—å¾ˆå¥½ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæ‚¨å¯èƒ½çœŸçš„ä¸ä¼šèŠ‚çœå¤ªå¤šç©ºé—´ã€‚è¿™å°±æ˜¯ Base62 ç¼–ç å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚

ä¸å‡ºæ‰€æ–™ï¼ŒBase62 ä½¿ç”¨äº† 62 ä¸ªå­—ç¬¦çš„æ˜ å°„[a-zA-Z0â€“9]ã€‚è¿™æ„å‘³ç€ 10ï¼Œ000ï¼Œ000 è¿™æ ·çš„é•¿æ•°å­—å¯ä»¥ç”¨æ›´ç´§å‡‘çš„â€œfxSKâ€æ¥è¡¨ç¤ºã€‚

æˆ‘è¿˜é€šè¿‡åœ¨è‡ªåŠ¨ç”Ÿæˆçš„ Base62 å­—ç¬¦ä¸²å‰é¢åŠ ä¸Šâ€œ.â€æ¥åŒºåˆ†è‡ªåŠ¨ç”Ÿæˆçš„ URL å’Œè‡ªå®šä¹‰çš„ URLï¼Œåœ¨é‡å®šå‘å¤„ç†æœŸé—´è§£ææä¾›çš„è·¯å¾„æ—¶ï¼Œå¦‚æœè·¯å¾„ä»¥â€œ.â€å¼€å¤´æˆ‘ä»¬çŸ¥é“æŸ¥è¯¢ id ç´¢å¼•ï¼Œå¦‚æœä¸çŸ¥é“ï¼Œæˆ‘ä»¬çŸ¥é“ä½¿ç”¨ friendlyUrl æŸ¥è¯¢ã€‚

## è¿è¡Œåº”ç”¨ç¨‹åº

å‡è®¾æ‚¨å·²ç»è®¾ç½®äº† docker-compose å¹¶éµå¾ªäº†ä¸Šé¢çš„æ­¥éª¤ï¼Œé‚£ä¹ˆåœ¨å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œåº”ç”¨ç¨‹åº(ä¸‹é¢æœ‰æ›´å¤šå…³äºç”Ÿäº§çš„å†…å®¹)åº”è¯¥å¾ˆç®€å•ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æˆ‘æ‰€æœ‰çš„ä»£ç ã€‚

è¦å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œåªéœ€ä»é¡¹ç›®çš„æ ¹ç›®å½•è¿è¡Œ`docker-compose up`ã€‚ç¬¬ä¸€æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œå› ä¸ºå®ƒéœ€è¦ä¸‹è½½ Vapor çš„æ‰€æœ‰ä¾èµ–é¡¹å¹¶æ„å»ºåº”ç”¨ç¨‹åºã€‚

è¦æ‰©å¤§æ‚¨è¿è¡Œçš„ swift èŠ‚ç‚¹æ•°é‡ï¼Œæ‚¨åªéœ€æ·»åŠ `--scale api=N`ï¼Œå…¶ä¸­ N æ˜¯æ‚¨æƒ³è¦çš„èŠ‚ç‚¹æ•°é‡ã€‚Docker åº”å¤„ç† Nginxã€Redis å’Œ Swift èŠ‚ç‚¹ä¹‹é—´çš„è·¯ç”±ã€‚

## ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ

å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºå­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œä½¿å®ƒæ— æ³•æˆä¸ºä¸€ä¸ªäº§å“åŒ–çš„æœåŠ¡ã€‚å¦‚æœæˆ‘ç»§ç»­è¿™ä¸ªä¾‹å­ï¼Œåœ¨éƒ¨ç½²è¿™ä¸ªåº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæˆ‘ä¼šæ·»åŠ ä¸€äº›ä¸œè¥¿ã€‚

*   æ·»åŠ å•å…ƒå’Œç»„ä»¶æµ‹è¯•è¦†ç›–ç‡

> è¿™å€¼å¾—è‡ªå·±å†™ä¸€æ•´ç¯‡æ–‡ç« ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æ¨¡ä»¿æˆ‘ä»¬çš„ä¾èµ–å…³ç³»ã€‚

*   ç”Ÿäº§é…ç½®å·²æ›´æ”¹

> åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ‰€æœ‰çš„ postgres å’Œ redis é…ç½®ä¿¡æ¯éƒ½è¢«ç¡¬ç¼–ç åˆ°åº”ç”¨ç¨‹åºå’Œ docker-compose æ–‡ä»¶ä¸­ã€‚å¯¹äºç”Ÿäº§å°±ç»ªå‹æœåŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›å¼ºåŒ–è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”å¯èƒ½ä¸ä¼šä½¿ç”¨å…¶ä»–ç¼–æ’æ¥ç®¡ç†æˆ‘ä»¬çš„æ•°æ®å­˜å‚¨ã€‚ä½†æ˜¯ docker-compose å¯¹æœ¬åœ°å‘å±•å¾ˆæœ‰å¸®åŠ©ã€‚

*   æé«˜å¼¹æ€§

> è¯¥åº”ç”¨ç¨‹åºç›®å‰å¯ä»¥å¤„ç†é”™è¯¯ï¼Œä½†å¦‚æœæˆ‘ä»¬çš„ Postgres å­˜å‚¨å˜å¾—æ— æ³•è®¿é—®æˆ–æˆ‘ä»¬çš„åŸå­è®¡æ•°å™¨è¢«é‡ç½®å¹¶ä¸ç°æœ‰è®°å½•å†²çªï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠâ€”â€”æ˜¾ç„¶è¿˜æœ‰å¾…æ”¹è¿›ã€‚

## å‚è€ƒ

[](https://github.com/vapor/vapor) [## è’¸æ±½/è’¸æ°”

### ğŸ’§æœåŠ¡å™¨ç«¯ Swift web æ¡†æ¶ã€‚åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸º vapor/vapor å¼€å‘åšè´¡çŒ®ã€‚

github.com](https://github.com/vapor/vapor) [](https://hackernoon.com/building-an-excellent-mock-server-in-swift-with-vapor-7e25aaa985e6) [## ä½¿ç”¨ Vapor åœ¨ Swift ä¸­æ„å»ºä¸€ä¸ªä¼˜ç§€çš„æ¨¡æ‹ŸæœåŠ¡å™¨

### Swiftï¼Œå®ƒä¸å†ä»…ä»…é€‚ç”¨äºç§»åŠ¨è®¾å¤‡â€¦

hackernoon.com](https://hackernoon.com/building-an-excellent-mock-server-in-swift-with-vapor-7e25aaa985e6) [](/@vaibhav0109/how-to-build-a-tiny-url-service-that-scales-to-billions-f6fb5ea22e8c) [## å¦‚ä½•æ„å»ºä¸€ä¸ªè§„æ¨¡è¾¾åˆ°æ•°åäº¿çš„å¾®å° URL æœåŠ¡ï¼Ÿ

### æ„å»ºä¸€ä¸ªè§„æ¨¡è¾¾åˆ°æ•°åäº¿çš„ url shortner æœåŠ¡æ˜¯ä¸€ä¸ªè½¯ä»¶æ¶æ„æŒ‘æˆ˜ã€‚è¿™ä¸ªåšå®¢æ¶µç›–äº†åŸºæœ¬çš„â€¦

medium.com](/@vaibhav0109/how-to-build-a-tiny-url-service-that-scales-to-billions-f6fb5ea22e8c) 

ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹è¿™ä¸ªé¡¹ç›®çš„æ‰€æœ‰ä»£ç ã€‚